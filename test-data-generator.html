<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BulSU Scheduling Test Data Generator</title>
    <style>
        :root {
            /* BulSU Colors mostly red/gold/white usually, but keeping the requested green theme or adapting? 
               Sticking to the existing Green theme to ensure UI consistency with previous requests, 
               but arguably BulSU is Gold/Red. I will keep the existing green theme to avoid breaking the user's styling preference 
               unless asked, but I will make the headers generic. */
            --primary: #d32f2f; /* Changed to Red for BulSU feel */
            --primary-dark: #9a0007;
            --primary-light: #ff6659;
            --bg-dark: #1a1a1a;
            --card-bg: rgba(30, 30, 30, 0.95);
            --text-light: #ffffff;
            --text-secondary: #e0e0e0;
            --border-color: rgba(211, 47, 47, 0.3);
            --success: #10b981;
            --warning: #ed8936;
            --danger: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #000000 100%);
            min-height: 100vh;
            color: var(--text-light);
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 24px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .card h2 {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.4rem;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            color: var(--primary-light);
        }

        .card h2 .icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
        }

        .form-group {
            margin-bottom: 18px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            color: var(--text-light);
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(211, 47, 47, 0.2);
        }

        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(211, 47, 47, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #059669, var(--success));
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #d97706, var(--warning));
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc2626, var(--danger));
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .preview-section {
            margin-top: 20px;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .preview-header h3 {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .preview-stats {
            display: flex;
            gap: 16px;
        }

        .stat-badge {
            padding: 6px 12px;
            background: rgba(211, 47, 47, 0.2);
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--primary-light);
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .preview-table th,
        .preview-table td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .preview-table th {
            background: rgba(0, 0, 0, 0.3);
            color: var(--text-secondary);
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .preview-table tbody tr:hover {
            background: rgba(211, 47, 47, 0.1);
        }

        .table-container {
            max-height: 300px;
            overflow-y: auto;
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }

        .table-container::-webkit-scrollbar {
            width: 8px;
        }

        .table-container::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
        }

        .table-container::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        .actions-section {
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            padding: 30px;
            text-align: center;
        }

        .actions-section h2 {
            margin-bottom: 10px;
            color: var(--primary-light);
        }

        .download-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            justify-content: center;
            margin-top: 20px;
        }

        .download-buttons .btn {
            min-width: 200px;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(237, 137, 54, 0.2);
            color: var(--warning);
        }

        .badge-info {
            background: rgba(211, 47, 47, 0.2);
            color: var(--primary-light);
        }

        .info-box {
            margin-top: 20px;
            padding: 16px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            text-align: left;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .info-box strong {
            color: var(--primary-light);
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            header h1 {
                font-size: 1.8rem;
            }
            .download-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéì BulSU Test Data Generator</h1>
            <p>Generate realistic CSV test data for the Bulacan State University (Main Campus)</p>
        </header>

        <div class="grid">
            <div class="card">
                <h2>
                    <span class="icon">üè´</span>
                    Campus & Rooms
                </h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>Campus</label>
                        <input type="text" id="campusName" value="Main Campus" readonly style="opacity: 0.7; cursor: not-allowed;">
                    </div>
                    <div class="form-group">
                        <label>Buildings</label>
                        <input type="number" id="buildingsPerCampus" value="8" min="1" max="20">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Rooms per Building</label>
                        <input type="number" id="roomsPerBuilding" value="10" min="1" max="50">
                    </div>
                    <div class="form-group">
                        <label>Max Floors</label>
                        <input type="number" id="maxFloors" value="5" min="1" max="10">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Min Capacity</label>
                        <input type="number" id="minCapacity" value="30" min="10" max="100">
                    </div>
                    <div class="form-group">
                        <label>Max Capacity</label>
                        <input type="number" id="maxCapacity" value="50" min="20" max="200">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="generateRooms()">
                    ‚ö° Generate Rooms
                </button>

                <div class="preview-section" id="roomsPreview" style="display: none;">
                    <div class="preview-header">
                        <h3>Preview</h3>
                        <div class="preview-stats">
                            <span class="stat-badge" id="roomCount">0 rooms</span>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="preview-table">
                            <thead>
                                <tr>
                                    <th>Campus</th>
                                    <th>Building</th>
                                    <th>Room</th>
                                    <th>Capacity</th>
                                    <th>Type</th>
                                    <th>Floor</th>
                                    <th>PWD</th>
                                </tr>
                            </thead>
                            <tbody id="roomsTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>
                    <span class="icon">üìö</span>
                    Class Schedules
                </h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>Number of Classes</label>
                        <input type="number" id="numClasses" value="50" min="5" max="500">
                    </div>
                    <div class="form-group">
                        <label>Sections per Course</label>
                        <input type="number" id="sectionsPerCourse" value="2" min="1" max="10">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Min Students per Section</label>
                        <input type="number" id="minStudents" value="20" min="5" max="100">
                    </div>
                    <div class="form-group">
                        <label>Max Students per Section</label>
                        <input type="number" id="maxStudents" value="50" min="10" max="200">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Semester</label>
                        <select id="semester">
                            <option value="1st Semester">1st Semester</option>
                            <option value="2nd Semester">2nd Semester</option>
                            <option value="Summer">Summer</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Academic Year</label>
                        <input type="text" id="academicYear" value="2025-2026">
                    </div>
                </div>
                <div class="form-group">
                    <label>College/Focus</label>
                    <select id="departmentFocus">
                        <option value="all">All Colleges</option>
                        </select>
                </div>
                <button class="btn btn-primary" onclick="generateClassSchedules()">
                    ‚ö° Generate Class Schedules
                </button>

                <div class="preview-section" id="classesPreview" style="display: none;">
                    <div class="preview-header">
                        <h3>Preview</h3>
                        <div class="preview-stats">
                            <span class="stat-badge" id="classCount">0 classes</span>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="preview-table">
                            <thead>
                                <tr>
                                    <th>Code</th>
                                    <th>College</th>
                                    <th>Course/Program</th>
                                    <th>Section</th>
                                    <th>Year</th>
                                    <th>Students</th>
                                    <th>Schedule</th>
                                </tr>
                            </thead>
                            <tbody id="classesTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>
                    <span class="icon">üë®‚Äçüè´</span>
                    Teacher Schedules
                </h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>Number of Teachers</label>
                        <input type="number" id="numTeachers" value="30" min="5" max="200">
                    </div>
                    <div class="form-group">
                        <label>Schedules per Teacher</label>
                        <input type="number" id="classesPerTeacher" value="3" min="1" max="10">
                    </div>
                </div>
                <div class="form-group">
                    <label>Assigned College</label>
                    <select id="teacherDepartment">
                        <option value="all">All Colleges</option>
                         </select>
                </div>
                <button class="btn btn-primary" onclick="generateTeacherSchedules()">
                    ‚ö° Generate Teacher Schedules
                </button>

                <div class="preview-section" id="teachersPreview" style="display: none;">
                    <div class="preview-header">
                        <h3>Preview</h3>
                        <div class="preview-stats">
                            <span class="stat-badge" id="teacherCount">0 teachers</span>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="preview-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>College</th>
                                    <th>Email</th>
                                    <th>Day/Time</th>
                                </tr>
                            </thead>
                            <tbody id="teachersTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="actions-section">
            <h2>üì• Download Generated Data</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Click to download CSV files formatted for the BulSU Scheduling System
            </p>
            <div class="download-buttons">
                <button class="btn btn-success" onclick="downloadCSV('rooms')" id="downloadRooms" disabled>
                    üè´ Download Rooms CSV
                </button>
                <button class="btn btn-warning" onclick="downloadCSV('classes')" id="downloadClasses" disabled>
                    üìö Download Classes CSV
                </button>
                <button class="btn btn-danger" onclick="downloadCSV('teachers')" id="downloadTeachers" disabled>
                    üë®‚Äçüè´ Download Teachers CSV
                </button>
            </div>
            <div class="download-buttons" style="margin-top: 16px;">
                <button class="btn btn-primary" onclick="downloadAllCSV()" id="downloadAll" disabled>
                    üì¶ Download All CSV Files
                </button>
                <button class="btn btn-primary" onclick="generateAll()" style="background: linear-gradient(135deg, #7c3aed, #a855f7);">
                    ‚ö° Generate All Data
                </button>
            </div>

             <div class="info-box">
                <strong>üìã CSV Format (Comma-separated):</strong><br><br>
                <strong>Rooms:</strong> campus, building, room, capacity, is_first_floor, floor_number, room_type, has_ac, has_projector, has_whiteboard, is_pwd_accessible, status<br>
                <em style="color: var(--text-secondary); font-size: 0.85rem;">üí° Campus is locked to "Main Campus"</em><br><br>
                <strong>Classes:</strong> course_code, course_name, section, year_level, student_count, lec_units, lab_units, credit_units, lec_hours, lab_hours, schedule_day, schedule_time, semester, academic_year, department, college, status<br>
                <em style="color: var(--text-secondary); font-size: 0.85rem;">üí° "Department" field contains the specific Program Name (e.g. BS Civil Engineering)</em><br><br>
                <strong>Teachers:</strong> teacher_id, teacher_name, schedule_day, schedule_time, department, email, college
            </div>
        </div>
    </div>

    <script>
        // ==================== Data Storage ====================
        let generatedData = {
            rooms: [],
            classes: [],
            teachers: []
        };

        // ==================== BulSU Data ====================
        const bulsuData = {
            "CAFA": {
                name: "College of Architecture and Fine Arts",
                programs: [
                    "Bachelor of Fine Arts Major in Visual Communication",
                    "Bachelor of Landscape Architecture",
                    "Bachelor of Science in Architecture"
                ],
                codePrefix: ["BFA", "BLA", "ARCH"]
            },
            "CAL": {
                name: "College of Arts and Letters",
                programs: [
                    "Bachelor of Arts in Broadcasting",
                    "Bachelor of Arts in Journalism",
                    "Bachelor of Performing Arts (Theater Track)",
                    "Batsilyer ng Sining sa Malikhaing Pagsulat"
                ],
                codePrefix: ["BRD", "JRN", "BPA", "BMP"]
            },
            "CBEA": {
                name: "College of Business Education and Accountancy",
                programs: [
                    "Bachelor of Science in Accountancy",
                    "Bachelor of Science in Business Administration Major in Business Economics",
                    "Bachelor of Science in Business Administration Major in Financial Management",
                    "Bachelor of Science in Business Administration Major in Marketing Management",
                    "Bachelor of Science in Entrepreneurship"
                ],
                codePrefix: ["ACC", "BAECON", "BAFIN", "BAMKT", "ENT"]
            },
            "CCJE": {
                name: "College of Criminal Justice Education",
                programs: [
                    "Bachelor of Arts in Legal Management",
                    "Bachelor of Science in Criminology"
                ],
                codePrefix: ["LM", "CRIM"]
            },
            "CHTM": {
                name: "College of Hospitality and Tourism Management",
                programs: [
                    "Bachelor of Science in Hospitality Management",
                    "Bachelor of Science in Tourism Management"
                ],
                codePrefix: ["HM", "TM"]
            },
            "CICT": {
                name: "College of Information and Communications Technology",
                programs: [
                    "Bachelor of Library and Information Science",
                    "Bachelor of Science in Information System",
                    "Bachelor of Science in Information Technology"
                ],
                codePrefix: ["BLIS", "IS", "IT"]
            },
            "CIT": {
                name: "College of Industrial Technology",
                programs: [
                    "BIT Automotive",
                    "BIT Computer",
                    "BIT Drafting",
                    "BIT Electrical",
                    "BIT Electronics & Communication",
                    "BIT Electronics",
                    "BIT Food Processing",
                    "BIT HVACR",
                    "BIT Mechanical",
                    "BIT Mechatronics",
                    "BIT Welding"
                ],
                codePrefix: ["AUTO", "COMPT", "DRAFT", "ELEC", "ECET", "ELT", "FOOD", "HVACR", "MECH", "MECHAT", "WELD"]
            },
            "CLaw": {
                name: "College of Law",
                programs: [
                    "Bachelor of Laws",
                    "Juris Doctor"
                ],
                codePrefix: ["LAW", "JD"]
            },
            "CN": {
                name: "College of Nursing",
                programs: [
                    "Bachelor of Science in Nursing"
                ],
                codePrefix: ["NURS"]
            },
            "COE": {
                name: "College of Engineering",
                programs: [
                    "Bachelor of Science in Civil Engineering",
                    "Bachelor of Science in Computer Engineering",
                    "Bachelor of Science in Electrical Engineering",
                    "Bachelor of Science in Electronics Engineering",
                    "Bachelor of Science in Industrial Engineering",
                    "Bachelor of Science in Manufacturing Engineering",
                    "Bachelor of Science in Mechanical Engineering",
                    "Bachelor of Science in Mechatronics Engineering"
                ],
                codePrefix: ["CE", "CPE", "EE", "ECE", "IE", "MFGE", "ME", "MCE"]
            },
            "COED": {
                name: "College of Education",
                programs: [
                    "Bachelor of Early Childhood Education",
                    "Bachelor of Elementary Education",
                    "Bachelor of Physical Education",
                    "BSED English",
                    "BSED Filipino",
                    "BSED Mathematics",
                    "BSED Sciences",
                    "BSED Social Studies",
                    "BSED Values Education",
                    "BTLE Home Economics",
                    "BTLE Industrial Arts",
                    "BTLE ICT"
                ],
                codePrefix: ["ECED", "BEED", "BPED", "ENG", "FIL", "MATH", "SCI", "SS", "VE", "THE", "TIA", "TICT"]
            },
            "CS": {
                name: "College of Science",
                programs: [
                    "Bachelor of Science in Biology",
                    "Bachelor of Science in Environmental Science",
                    "Bachelor of Science in Food Technology",
                    "BS Math (Applied Statistics)",
                    "BS Math (Business Applications)",
                    "BS Math (Computer Science)"
                ],
                codePrefix: ["BIO", "ENVI", "FT", "STAT", "MBA", "MCS"]
            },
            "CSER": {
                name: "College of Sports, Exercise and Recreation",
                programs: [
                    "BSESS Fitness and Sports Coaching",
                    "BSESS Fitness and Sports Management",
                    "Certificate of Physical Education"
                ],
                codePrefix: ["COACH", "MGMT", "CPE"]
            },
            "CSSP": {
                name: "College of Social Sciences and Philosophy",
                programs: [
                    "Bachelor of Public Administration",
                    "Bachelor of Science in Psychology",
                    "Bachelor of Science in Social Work"
                ],
                codePrefix: ["BPA", "PSYCH", "SW"]
            },
            "GS": {
                name: "Graduate School",
                programs: [
                    "Doctor of Education",
                    "Doctor of Philosophy",
                    "Doctor of Public Administration",
                    "Master in Business Administration",
                    "Master in Physical Education",
                    "Master in Public Administration",
                    "Master of Arts in Education",
                    "Master of Engineering Program",
                    "Master of Industrial Technology Management",
                    "Master of Information Technology",
                    "Master of Manufacturing Engineering",
                    "Master of Science in Civil Engineering",
                    "Master of Science in Computer Engineering",
                    "Master of Science in Electronics and Communications Engineering"
                ],
                codePrefix: ["DED", "PHD", "DPA", "MBA", "MPE", "MPA", "MAED", "MEP", "MITM", "MIT", "MME", "MSCE", "MSCPE", "MSECE"]
            }
        };

        // ==================== Initialization ====================
        window.onload = function() {
            populateCollegeDropdowns();
        };

        function populateCollegeDropdowns() {
            const classSelect = document.getElementById('departmentFocus');
            const teacherSelect = document.getElementById('teacherDepartment');
            
            Object.keys(bulsuData).forEach(key => {
                const college = bulsuData[key];
                const option = `<option value="${key}">${college.name} (${key})</option>`;
                classSelect.insertAdjacentHTML('beforeend', option);
                teacherSelect.insertAdjacentHTML('beforeend', option);
            });
        }

        // ==================== Random Data Generators ====================
        const buildingNames = [
            'Valencia Hall', 'Alvarado Hall', 'Federizo Hall', 'Natividad Hall', 
            'Flores Hall', 'Carpio Hall', 'CIT Building', 'CIDE Building', 
            'CSSP Building', 'Engineering Building', 'Information Tech Building', 
            'University Hostel', 'Science Research Center'
        ]; // Realistic BulSU Main Campus buildings logic
        
        const roomTypes = ['Lecture Room', 'Laboratory', 'Computer Lab', 'Smart Room', 'Drawing Room', 'AVR'];
        const firstNames = ['Juan', 'Maria', 'Jose', 'Ana', 'Miguel', 'Sofia', 'Carlos', 'Isabella', 'Antonio', 'Gabriela', 'Luis', 'Carmen', 'Francisco', 'Patricia', 'Rafael', 'Elena', 'Diego', 'Rosa', 'Manuel', 'Teresa', 'Pedro', 'Laura', 'Fernando', 'Lucia', 'Ricardo', 'Angela', 'Alberto', 'Beatriz', 'Eduardo', 'Clara'];
        const lastNames = ['Santos', 'Reyes', 'Cruz', 'Garcia', 'Torres', 'Ramos', 'Flores', 'Rivera', 'Martinez', 'Lopez', 'Gonzales', 'Hernandez', 'Perez', 'Sanchez', 'Ramirez', 'Diaz', 'Morales', 'Jimenez', 'Ruiz', 'Vargas', 'Castillo', 'Mendoza', 'Romero', 'Aquino', 'Dela Cruz', 'Villanueva', 'Bautista', 'Navarro', 'Fernandez', 'Castro'];
        const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        const timeSlots = ['7:00-10:00', '10:00-13:00', '13:00-16:00', '16:00-19:00'];
        
        // ==================== Utility Functions ====================
        function random(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function randomElement(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function generateEmail(firstName, lastName) {
            const cleanFirst = firstName.toLowerCase().replace(/[^a-z]/g, '');
            const cleanLast = lastName.toLowerCase().replace(/[^a-z]/g, '');
            return `${cleanFirst}.${cleanLast}@bulsu.edu.ph`;
        }

        function generateTeacherId(index) {
            // T-2025-XXXX format
            return `T-2025-${String(index).padStart(4, '0')}`;
        }

        function generateSubjectName(prefix, level) {
            const subjects = [
                "Fundamentals", "Principles", "Introduction to", "Advanced", "Applied", 
                "Contemporary", "Research in", "Management of", "Theories of", "Ethics in"
            ];
            const suffix = [
                "System", "Analysis", "Design", "Communication", "Development", 
                "Technology", "Practice", "Studies", "Planning", "Methods"
            ];
            return `${randomElement(subjects)} ${prefix} ${randomElement(suffix)}`;
        }

        // ==================== Room Generation ====================
        function generateRooms() {
            const buildingsPerCampus = parseInt(document.getElementById('buildingsPerCampus').value);
            const roomsPerBuilding = parseInt(document.getElementById('roomsPerBuilding').value);
            const maxFloors = parseInt(document.getElementById('maxFloors').value);
            const minCapacity = parseInt(document.getElementById('minCapacity').value);
            const maxCapacity = parseInt(document.getElementById('maxCapacity').value);

            generatedData.rooms = [];
            const campusName = "Main Campus"; // Hardcoded as requested

            // Create a pool of buildings
            let activeBuildings = buildingNames.slice(0, buildingsPerCampus);
            if (buildingsPerCampus > buildingNames.length) {
                for (let i = 0; i < buildingsPerCampus - buildingNames.length; i++) {
                    activeBuildings.push(`Annex Building ${i+1}`);
                }
            }

            for (let b = 0; b < activeBuildings.length; b++) {
                const buildingName = activeBuildings[b];
                
                for (let r = 0; r < roomsPerBuilding; r++) {
                    const floor = random(1, maxFloors);
                    const roomNumber = floor * 100 + random(1, 20);
                    const capacity = random(minCapacity, maxCapacity);
                    const roomType = randomElement(roomTypes);
                    const isPwdAccessible = floor === 1 || Math.random() < 0.6; // High PWD accessibility chance

                    generatedData.rooms.push({
                        campus: campusName,
                        building: buildingName,
                        room: `${buildingName.substring(0, 3).toUpperCase()}-${roomNumber}`,
                        capacity: capacity,
                        is_first_floor: floor === 1,
                        floor_number: floor,
                        room_type: roomType,
                        has_ac: Math.random() > 0.2, // 80% have AC
                        has_projector: Math.random() > 0.4,
                        has_whiteboard: true,
                        is_pwd_accessible: isPwdAccessible,
                        status: 'active'
                    });
                }
            }

            updateRoomsPreview();
            document.getElementById('downloadRooms').disabled = false;
            checkAllGenerated();
        }

        function updateRoomsPreview() {
            const preview = document.getElementById('roomsPreview');
            const tableBody = document.getElementById('roomsTableBody');
            const countBadge = document.getElementById('roomCount');

            preview.style.display = 'block';
            countBadge.textContent = `${generatedData.rooms.length} rooms`;

            tableBody.innerHTML = generatedData.rooms.slice(0, 50).map(room => `
                <tr>
                    <td>${room.campus}</td>
                    <td>${room.building}</td>
                    <td>${room.room}</td>
                    <td>${room.capacity}</td>
                    <td><span class="badge badge-info">${room.room_type}</span></td>
                    <td>${room.floor_number}</td>
                    <td>${room.is_pwd_accessible ? '<span class="badge badge-success">Yes</span>' : '<span class="badge badge-warning">No</span>'}</td>
                </tr>
            `).join('');
        }

        // ==================== Class Schedules Generation ====================
        function generateClassSchedules() {
            const numClasses = parseInt(document.getElementById('numClasses').value);
            const sectionsPerCourse = parseInt(document.getElementById('sectionsPerCourse').value);
            const minStudents = parseInt(document.getElementById('minStudents').value) || 20;
            const maxStudents = parseInt(document.getElementById('maxStudents').value) || 50;
            const semester = document.getElementById('semester').value;
            const academicYear = document.getElementById('academicYear').value;
            const focus = document.getElementById('departmentFocus').value;

            generatedData.classes = [];

            const sectionLetters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            let generatedCount = 0;

            while (generatedCount < numClasses) {
                // Determine College
                let collegeKey;
                if (focus === 'all') {
                    const keys = Object.keys(bulsuData);
                    collegeKey = keys[Math.floor(Math.random() * keys.length)];
                } else {
                    collegeKey = focus;
                }

                const collegeData = bulsuData[collegeKey];
                
                // Select random program within college
                const programIndex = Math.floor(Math.random() * collegeData.programs.length);
                const programName = collegeData.programs[programIndex];
                const prefix = collegeData.codePrefix[programIndex];
                
                // Generate Course Code
                const yearLevel = random(1, 4);
                const subjectNum = random(1, 99);
                const courseCode = `${prefix}${yearLevel}${String(subjectNum).padStart(2, '0')}`;
                
                // Units - Major courses have 3 units lec, some have additional 3hr lab
                const lec = 3; // Always 3 units for lecture
                const lab = Math.random() > 0.5 ? 1 : 0; // 50% chance of lab for major courses

                // Generate multiple sections for this course
                for (let s = 0; s < sectionsPerCourse; s++) {
                    if (generatedCount >= numClasses) break;

                    const day = randomElement(days);
                    const time = randomElement(timeSlots);

                    // Generate realistic student count based on user inputs
                    const studentCount = random(minStudents, maxStudents);
                    
                    generatedData.classes.push({
                        course_code: courseCode,
                        course_name: generateSubjectName(prefix, yearLevel),
                        section: `${yearLevel}${sectionLetters[s]}`,
                        year_level: yearLevel,
                        student_count: studentCount,
                        lec_units: lec,
                        lab_units: lab,
                        credit_units: lec + lab,
                        lec_hours: 3, // Always 3 hours lecture
                        lab_hours: lab * 3, // 3 hours lab if has lab component
                        schedule_day: day,
                        schedule_time: time,
                        semester: semester,
                        academic_year: academicYear,
                        department: programName, // Mapping Program Name to Department Field
                        college: collegeData.name, // Full College Name
                        status: 'pending'
                    });
                    generatedCount++;
                }
            }

            updateClassesPreview();
            document.getElementById('downloadClasses').disabled = false;
            checkAllGenerated();
        }

        function updateClassesPreview() {
            const preview = document.getElementById('classesPreview');
            const tableBody = document.getElementById('classesTableBody');
            const countBadge = document.getElementById('classCount');

            preview.style.display = 'block';
            countBadge.textContent = `${generatedData.classes.length} classes`;

            tableBody.innerHTML = generatedData.classes.slice(0, 50).map(c => `
                <tr>
                    <td><strong>${c.course_code}</strong></td>
                    <td><small>${c.college.substring(0, 20)}...</small></td>
                    <td>${c.department.substring(0, 25)}...</td>
                    <td><span class="badge badge-info">${c.section}</span></td>
                    <td><span class="badge badge-warning">Year ${c.year_level}</span></td>
                    <td><span class="badge badge-success">${c.student_count}</span></td>
                    <td>${c.schedule_day} ${c.schedule_time}</td>
                </tr>
            `).join('');
        }

        // ==================== Teacher Schedules Generation ====================
        function generateTeacherSchedules() {
            const numTeachers = parseInt(document.getElementById('numTeachers').value);
            const classesPerTeacher = parseInt(document.getElementById('classesPerTeacher').value);
            const focus = document.getElementById('teacherDepartment').value;

            generatedData.teachers = [];

            for (let i = 0; i < numTeachers; i++) {
                const firstName = randomElement(firstNames);
                const lastName = randomElement(lastNames);
                
                // Determine Teacher's College
                let collegeKey;
                if (focus === 'all') {
                    const keys = Object.keys(bulsuData);
                    collegeKey = keys[Math.floor(Math.random() * keys.length)];
                } else {
                    collegeKey = focus;
                }
                const collegeData = bulsuData[collegeKey];

                const numClasses = random(Math.max(1, classesPerTeacher - 1), classesPerTeacher + 1);

                for (let c = 0; c < numClasses; c++) {
                    generatedData.teachers.push({
                        teacher_id: generateTeacherId(i + 1),
                        teacher_name: `Prof. ${firstName} ${lastName}`,
                        schedule_day: randomElement(days),
                        schedule_time: randomElement(timeSlots),
                        department: randomElement(collegeData.programs), // Assign them to a specific program within college
                        email: generateEmail(firstName, lastName),
                        college: collegeData.name
                    });
                }
            }

            updateTeachersPreview();
            document.getElementById('downloadTeachers').disabled = false;
            checkAllGenerated();
        }

        function updateTeachersPreview() {
            const preview = document.getElementById('teachersPreview');
            const tableBody = document.getElementById('teachersTableBody');
            const countBadge = document.getElementById('teacherCount');

            preview.style.display = 'block';
            // Count unique teachers
            const uniqueTeachers = new Set(generatedData.teachers.map(t => t.teacher_id)).size;
            countBadge.textContent = `${uniqueTeachers} teachers, ${generatedData.teachers.length} schedules`;

            // Filter for display (unique only)
            const seen = new Set();
            const displayData = generatedData.teachers.filter(t => {
                const duplicate = seen.has(t.teacher_id);
                seen.add(t.teacher_id);
                return !duplicate;
            });

            tableBody.innerHTML = displayData.slice(0, 50).map(t => `
                <tr>
                    <td>${t.teacher_id}</td>
                    <td>${t.teacher_name}</td>
                    <td><span class="badge badge-info">${t.college.match(/\(([^)]+)\)/)?.[1] || t.college.substring(0,4)}</span></td>
                    <td>${t.email}</td>
                    <td>${t.schedule_day} ${t.schedule_time}</td>
                </tr>
            `).join('');
        }

        // ==================== CSV Download Functions ====================
        function convertToCSV(data, type) {
            if (data.length === 0) return '';

            const headers = {
                rooms: ['campus', 'building', 'room', 'capacity', 'is_first_floor', 'floor_number', 'room_type', 'has_ac', 'has_projector', 'has_whiteboard', 'is_pwd_accessible', 'status'],
                classes: ['course_code', 'course_name', 'section', 'year_level', 'student_count', 'lec_units', 'lab_units', 'credit_units', 'lec_hours', 'lab_hours', 'schedule_day', 'schedule_time', 'semester', 'academic_year', 'department', 'college', 'status'],
                teachers: ['teacher_id', 'teacher_name', 'schedule_day', 'schedule_time', 'department', 'email', 'college']
            };

            const cols = headers[type];
            const csvRows = [cols.join(',')];

            for (const row of data) {
                const values = cols.map(col => {
                    let val = row[col];
                    if (val === undefined || val === null) val = '';
                    if (typeof val === 'boolean') val = val ? 'true' : 'false';
                    let strVal = String(val);
                    if (strVal.includes(',') || strVal.includes('"') || strVal.includes('\n')) {
                        strVal = '"' + strVal.replace(/"/g, '""') + '"';
                    }
                    return strVal;
                });
                csvRows.push(values.join(','));
            }

            return csvRows.join('\n');
        }

        function downloadCSV(type) {
            const data = generatedData[type];
            if (!data || data.length === 0) {
                alert(`No ${type} data generated yet!`);
                return;
            }

            const csv = convertToCSV(data, type);
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            const filename = {
                rooms: 'bulsu_rooms_main.csv',
                classes: 'bulsu_class_schedules.csv',
                teachers: 'bulsu_faculty_schedules.csv'
            };

            link.setAttribute('href', url);
            link.setAttribute('download', filename[type]);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        async function downloadAllCSV() {
            const types = ['rooms', 'classes', 'teachers'];
            const hasAll = types.every(type => generatedData[type] && generatedData[type].length > 0);
            
            if (!hasAll) {
                alert('Please generate all data types before downloading all!');
                return;
            }

            for (const type of types) {
                downloadCSV(type);
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }

        function checkAllGenerated() {
            const types = ['rooms', 'classes', 'teachers'];
            const hasAll = types.every(type => generatedData[type] && generatedData[type].length > 0);
            document.getElementById('downloadAll').disabled = !hasAll;
        }

        function generateAll() {
            generateRooms();
            generateClassSchedules();
            generateTeacherSchedules();
        }
    </script>
</body>
</html>