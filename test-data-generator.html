<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room Scheduling Test Data Generator</title>
    <style>
        :root {
            --primary: #00a651;
            --primary-dark: #005826;
            --primary-light: #4cff96;
            --bg-dark: #003d1a;
            --card-bg: rgba(0, 88, 38, 0.95);
            --text-light: #ffffff;
            --text-secondary: #a8e6c0;
            --border-color: rgba(0, 166, 81, 0.3);
            --success: #10b981;
            --warning: #ed8936;
            --danger: #ef4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, #002d12 100%);
            min-height: 100vh;
            color: var(--text-light);
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 24px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            padding: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .card h2 {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.4rem;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            color: var(--primary-light);
        }

        .card h2 .icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .form-group {
            margin-bottom: 18px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.3);
            color: var(--text-light);
            font-size: 1rem;
            transition: all 0.2s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 166, 81, 0.2);
        }

        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 166, 81, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #059669, var(--success));
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #d97706, var(--warning));
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc2626, var(--danger));
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .preview-section {
            margin-top: 20px;
        }

        .preview-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .preview-header h3 {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .preview-stats {
            display: flex;
            gap: 16px;
        }

        .stat-badge {
            padding: 6px 12px;
            background: rgba(0, 166, 81, 0.2);
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--primary-light);
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }

        .preview-table th,
        .preview-table td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .preview-table th {
            background: rgba(0, 0, 0, 0.3);
            color: var(--text-secondary);
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .preview-table tbody tr:hover {
            background: rgba(0, 166, 81, 0.1);
        }

        .table-container {
            max-height: 300px;
            overflow-y: auto;
            border-radius: 10px;
            border: 1px solid var(--border-color);
        }

        .table-container::-webkit-scrollbar {
            width: 8px;
        }

        .table-container::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
        }

        .table-container::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        .actions-section {
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            padding: 30px;
            text-align: center;
        }

        .actions-section h2 {
            margin-bottom: 10px;
            color: var(--primary-light);
        }

        .download-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            justify-content: center;
            margin-top: 20px;
        }

        .download-buttons .btn {
            min-width: 200px;
        }

        .badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .badge-warning {
            background: rgba(237, 137, 54, 0.2);
            color: var(--warning);
        }

        .badge-info {
            background: rgba(0, 166, 81, 0.2);
            color: var(--primary-light);
        }

        .info-box {
            margin-top: 20px;
            padding: 16px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            text-align: left;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .info-box strong {
            color: var(--primary-light);
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            header h1 {
                font-size: 1.8rem;
            }
            .download-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéì Room Scheduling Test Data Generator</h1>
            <p>Generate realistic CSV test data for the Quantum-Inspired Room Allocation System</p>
        </header>

        <div class="grid">
            <!-- Campus/Rooms Generator -->
            <div class="card">
                <h2>
                    <span class="icon">üè´</span>
                    Campus & Rooms
                </h2>
                <!-- school_name is entered in UploadCSV page, not in generator -->
                <div class="form-row">
                    <div class="form-group">
                        <label>Number of Campuses</label>
                        <input type="number" id="numCampuses" value="2" min="1" max="10">
                    </div>
                    <div class="form-group">
                        <label>Buildings per Campus</label>
                        <input type="number" id="buildingsPerCampus" value="3" min="1" max="10">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Rooms per Building</label>
                        <input type="number" id="roomsPerBuilding" value="5" min="1" max="20">
                    </div>
                    <div class="form-group">
                        <label>Max Floors</label>
                        <input type="number" id="maxFloors" value="4" min="1" max="10">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Min Capacity</label>
                        <input type="number" id="minCapacity" value="20" min="10" max="100">
                    </div>
                    <div class="form-group">
                        <label>Max Capacity</label>
                        <input type="number" id="maxCapacity" value="60" min="20" max="200">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="generateRooms()">
                    ‚ö° Generate Rooms
                </button>

                <div class="preview-section" id="roomsPreview" style="display: none;">
                    <div class="preview-header">
                        <h3>Preview</h3>
                        <div class="preview-stats">
                            <span class="stat-badge" id="roomCount">0 rooms</span>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="preview-table">
                            <thead>
                                <tr>
                                    <th>Campus</th>
                                    <th>Building</th>
                                    <th>Room</th>
                                    <th>Capacity</th>
                                    <th>Type</th>
                                    <th>Floor</th>
                                    <th>PWD</th>
                                </tr>
                            </thead>
                            <tbody id="roomsTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Class Schedules Generator -->
            <div class="card">
                <h2>
                    <span class="icon">üìö</span>
                    Class Schedules
                </h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>Number of Classes</label>
                        <input type="number" id="numClasses" value="30" min="5" max="200">
                    </div>
                    <div class="form-group">
                        <label>Sections per Course</label>
                        <input type="number" id="sectionsPerCourse" value="3" min="1" max="10">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Semester</label>
                        <select id="semester">
                            <option value="1st Semester">1st Semester</option>
                            <option value="2nd Semester">2nd Semester</option>
                            <option value="Summer">Summer</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Academic Year</label>
                        <input type="text" id="academicYear" value="2025-2026">
                    </div>
                </div>
                <div class="form-group">
                    <label>Department Focus</label>
                    <select id="departmentFocus">
                        <option value="all">All Departments</option>
                        <option value="cs">Computer Science</option>
                        <option value="engineering">Engineering</option>
                        <option value="business">Business</option>
                        <option value="arts">Arts & Sciences</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="generateClassSchedules()">
                    ‚ö° Generate Class Schedules
                </button>

                <div class="preview-section" id="classesPreview" style="display: none;">
                    <div class="preview-header">
                        <h3>Preview</h3>
                        <div class="preview-stats">
                            <span class="stat-badge" id="classCount">0 classes</span>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="preview-table">
                            <thead>
                                <tr>
                                    <th>Code</th>
                                    <th>Course</th>
                                    <th>Section</th>
                                    <th>Day</th>
                                    <th>Time</th>
                                    <th>Units</th>
                                </tr>
                            </thead>
                            <tbody id="classesTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Teacher Schedules Generator -->
            <div class="card">
                <h2>
                    <span class="icon">üë®‚Äçüè´</span>
                    Teacher Schedules
                </h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>Number of Teachers</label>
                        <input type="number" id="numTeachers" value="20" min="5" max="100">
                    </div>
                    <div class="form-group">
                        <label>Schedules per Teacher (Avg)</label>
                        <input type="number" id="classesPerTeacher" value="4" min="1" max="10">
                    </div>
                </div>
                <div class="form-group">
                    <label>Department</label>
                    <select id="teacherDepartment">
                        <option value="all">All Departments</option>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Engineering">Engineering</option>
                        <option value="Business">Business Administration</option>
                        <option value="Arts">Arts & Sciences</option>
                        <option value="Education">Education</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="generateTeacherSchedules()">
                    ‚ö° Generate Teacher Schedules
                </button>

                <div class="preview-section" id="teachersPreview" style="display: none;">
                    <div class="preview-header">
                        <h3>Preview</h3>
                        <div class="preview-stats">
                            <span class="stat-badge" id="teacherCount">0 teachers</span>
                        </div>
                    </div>
                    <div class="table-container">
                        <table class="preview-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Department</th>
                                    <th>Day</th>
                                    <th>Time</th>
                                </tr>
                            </thead>
                            <tbody id="teachersTableBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Download Section -->
        <div class="actions-section">
            <h2>üì• Download Generated Data</h2>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Click to download CSV files for upload to the scheduling system
            </p>
            <div class="download-buttons">
                <button class="btn btn-success" onclick="downloadCSV('rooms')" id="downloadRooms" disabled>
                    üè´ Download Rooms CSV
                </button>
                <button class="btn btn-warning" onclick="downloadCSV('classes')" id="downloadClasses" disabled>
                    üìö Download Classes CSV
                </button>
                <button class="btn btn-danger" onclick="downloadCSV('teachers')" id="downloadTeachers" disabled>
                    üë®‚Äçüè´ Download Teachers CSV
                </button>
            </div>
            <div class="download-buttons" style="margin-top: 16px;">
                <button class="btn btn-primary" onclick="downloadAllCSV()" id="downloadAll" disabled>
                    üì¶ Download All CSV Files
                </button>
                <button class="btn btn-primary" onclick="generateAll()" style="background: linear-gradient(135deg, #7c3aed, #a855f7);">
                    ‚ö° Generate All Data
                </button>
            </div>

            <div class="info-box">
                <strong>üìã CSV Format (Comma-separated):</strong><br><br>
                <strong>Rooms:</strong> campus, building, room, capacity, is_first_floor, floor_number, room_type, has_ac, has_projector, has_whiteboard, is_pwd_accessible, status<br>
                <em style="color: var(--text-secondary); font-size: 0.85rem;">üí° school_name is entered separately in the Upload CSV page</em><br><br>
                <strong>Classes:</strong> course_code, course_name, section, lec_units, lab_units, credit_units, lec_hours, lab_hours, schedule_day, schedule_time, semester, academic_year, department, college, status<br><br>
                <strong>Teachers:</strong> teacher_id, teacher_name, schedule_day, schedule_time, department, email, college
            </div>
        </div>
    </div>

    <script>
        // ==================== Data Storage ====================
        let generatedData = {
            rooms: [],
            classes: [],
            teachers: []
        };

        // ==================== Random Data Generators ====================
        const campusNames = ['Main Campus', 'North Campus', 'South Campus', 'East Campus', 'West Campus', 'Downtown Campus', 'Science Campus', 'Engineering Campus'];
        const buildingNames = ['Academic Building', 'Science Hall', 'Engineering Complex', 'Business Center', 'Arts Building', 'Library Building', 'Technology Center', 'Innovation Hub', 'Learning Center', 'Research Building'];
        const roomTypes = ['Classroom', 'Laboratory', 'Lecture Hall', 'Computer Lab', 'Conference Room', 'Seminar Room'];
        const firstNames = ['Juan', 'Maria', 'Jose', 'Ana', 'Miguel', 'Sofia', 'Carlos', 'Isabella', 'Antonio', 'Gabriela', 'Luis', 'Carmen', 'Francisco', 'Patricia', 'Rafael', 'Elena', 'Diego', 'Rosa', 'Manuel', 'Teresa', 'Pedro', 'Laura', 'Fernando', 'Lucia', 'Ricardo', 'Angela', 'Alberto', 'Beatriz', 'Eduardo', 'Clara'];
        const lastNames = ['Santos', 'Reyes', 'Cruz', 'Garcia', 'Torres', 'Ramos', 'Flores', 'Rivera', 'Martinez', 'Lopez', 'Gonzales', 'Hernandez', 'Perez', 'Sanchez', 'Ramirez', 'Diaz', 'Morales', 'Jimenez', 'Ruiz', 'Vargas', 'Castillo', 'Mendoza', 'Romero', 'Aquino', 'Dela Cruz', 'Villanueva', 'Bautista', 'Navarro', 'Fernandez', 'Castro'];
        const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
        const timeSlots = ['7:00-8:30', '8:30-10:00', '10:00-11:30', '11:30-13:00', '13:00-14:30', '14:30-16:00', '16:00-17:30', '17:30-19:00'];
        
        const coursesData = {
            cs: [
                { code: 'CS101', name: 'Introduction to Computer Science', lec: 3, lab: 0 },
                { code: 'CS102', name: 'Data Structures and Algorithms', lec: 3, lab: 1 },
                { code: 'CS103', name: 'Object-Oriented Programming', lec: 2, lab: 2 },
                { code: 'CS201', name: 'Database Management Systems', lec: 3, lab: 1 },
                { code: 'CS202', name: 'Web Development', lec: 2, lab: 2 },
                { code: 'CS301', name: 'Software Engineering', lec: 3, lab: 1 },
                { code: 'CS302', name: 'Artificial Intelligence', lec: 3, lab: 1 },
                { code: 'CS401', name: 'Machine Learning', lec: 3, lab: 1 }
            ],
            engineering: [
                { code: 'ENG101', name: 'Engineering Mathematics', lec: 3, lab: 0 },
                { code: 'ENG102', name: 'Engineering Drawing', lec: 1, lab: 2 },
                { code: 'ENG201', name: 'Thermodynamics', lec: 3, lab: 1 },
                { code: 'ENG202', name: 'Mechanics of Materials', lec: 3, lab: 1 },
                { code: 'ENG301', name: 'Circuit Analysis', lec: 3, lab: 1 },
                { code: 'ENG302', name: 'Digital Electronics', lec: 2, lab: 2 }
            ],
            business: [
                { code: 'BUS101', name: 'Principles of Management', lec: 3, lab: 0 },
                { code: 'BUS102', name: 'Financial Accounting', lec: 3, lab: 0 },
                { code: 'BUS201', name: 'Marketing Management', lec: 3, lab: 0 },
                { code: 'BUS202', name: 'Business Statistics', lec: 3, lab: 1 },
                { code: 'BUS301', name: 'Operations Management', lec: 3, lab: 0 },
                { code: 'BUS302', name: 'Human Resource Management', lec: 3, lab: 0 }
            ],
            arts: [
                { code: 'ART101', name: 'Introduction to Philosophy', lec: 3, lab: 0 },
                { code: 'ART102', name: 'World Literature', lec: 3, lab: 0 },
                { code: 'ART201', name: 'Psychology 101', lec: 3, lab: 0 },
                { code: 'ART202', name: 'Sociology', lec: 3, lab: 0 },
                { code: 'ART301', name: 'Communication Skills', lec: 2, lab: 1 },
                { code: 'ART302', name: 'Critical Thinking', lec: 3, lab: 0 }
            ]
        };

        // ==================== Utility Functions ====================
        function random(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function randomElement(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        function generateEmail(firstName, lastName, domain = 'faculty.edu.ph') {
            const cleanFirst = firstName.toLowerCase().replace(/[^a-z]/g, '');
            const cleanLast = lastName.toLowerCase().replace(/[^a-z]/g, '');
            return `${cleanFirst}.${cleanLast}@${domain}`;
        }

        function generateTeacherId(index) {
            return `T-${String(index).padStart(4, '0')}`;
        }

        // ==================== Room Generation ====================
        function generateRooms() {
            // school_name is entered in UploadCSV page, not in generator
            const numCampuses = parseInt(document.getElementById('numCampuses').value);
            const buildingsPerCampus = parseInt(document.getElementById('buildingsPerCampus').value);
            const roomsPerBuilding = parseInt(document.getElementById('roomsPerBuilding').value);
            const maxFloors = parseInt(document.getElementById('maxFloors').value);
            const minCapacity = parseInt(document.getElementById('minCapacity').value);
            const maxCapacity = parseInt(document.getElementById('maxCapacity').value);

            generatedData.rooms = [];

            for (let c = 0; c < numCampuses; c++) {
                const campusName = campusNames[c % campusNames.length];
                
                for (let b = 0; b < buildingsPerCampus; b++) {
                    const buildingName = buildingNames[b % buildingNames.length];
                    
                    for (let r = 0; r < roomsPerBuilding; r++) {
                        const floor = random(1, maxFloors);
                        const roomNumber = floor * 100 + random(1, 20);
                        const capacity = random(minCapacity, maxCapacity);
                        const roomType = randomElement(roomTypes);
                        const isPwdAccessible = floor === 1 || Math.random() < 0.3;

                        generatedData.rooms.push({
                            // school_name is added in UploadCSV page
                            campus: campusName,
                            building: buildingName,
                            room: `${buildingName.substring(0, 2).toUpperCase()}${roomNumber}`,
                            capacity: capacity,
                            is_first_floor: floor === 1,
                            floor_number: floor,
                            room_type: roomType,
                            has_ac: Math.random() > 0.3,
                            has_projector: Math.random() > 0.4,
                            has_whiteboard: true,
                            is_pwd_accessible: isPwdAccessible,
                            status: 'active'
                        });
                    }
                }
            }

            updateRoomsPreview();
            document.getElementById('downloadRooms').disabled = false;
            checkAllGenerated();
        }

        function updateRoomsPreview() {
            const preview = document.getElementById('roomsPreview');
            const tableBody = document.getElementById('roomsTableBody');
            const countBadge = document.getElementById('roomCount');

            preview.style.display = 'block';
            countBadge.textContent = `${generatedData.rooms.length} rooms`;

            tableBody.innerHTML = generatedData.rooms.slice(0, 50).map(room => `
                <tr>
                    <td>${room.campus}</td>
                    <td>${room.building}</td>
                    <td>${room.room}</td>
                    <td>${room.capacity}</td>
                    <td><span class="badge badge-info">${room.room_type}</span></td>
                    <td>${room.floor_number}</td>
                    <td>${room.is_pwd_accessible ? '<span class="badge badge-success">Yes</span>' : '<span class="badge badge-warning">No</span>'}</td>
                </tr>
            `).join('');
        }

        // ==================== Class Schedules Generation ====================
        function generateClassSchedules() {
            const numClasses = parseInt(document.getElementById('numClasses').value);
            const sectionsPerCourse = parseInt(document.getElementById('sectionsPerCourse').value);
            const semester = document.getElementById('semester').value;
            const academicYear = document.getElementById('academicYear').value;
            const departmentFocus = document.getElementById('departmentFocus').value;

            generatedData.classes = [];

            // Get courses based on department focus
            let courses = [];
            if (departmentFocus === 'all') {
                courses = [...coursesData.cs, ...coursesData.engineering, ...coursesData.business, ...coursesData.arts];
            } else {
                courses = coursesData[departmentFocus] || coursesData.cs;
            }

            const sectionLetters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            let classIndex = 0;

            while (classIndex < numClasses) {
                const course = courses[classIndex % courses.length];
                const numSections = Math.min(sectionsPerCourse, numClasses - classIndex);

                for (let s = 0; s < numSections && classIndex < numClasses; s++) {
                    const day = randomElement(days);
                    const time = randomElement(timeSlots);

                    generatedData.classes.push({
                        course_code: course.code,
                        course_name: course.name,
                        section: sectionLetters[s],
                        lec_units: course.lec,
                        lab_units: course.lab,
                        credit_units: course.lec + course.lab,
                        lec_hours: course.lec,
                        lab_hours: course.lab * 3,
                        schedule_day: day,
                        schedule_time: time,
                        semester: semester,
                        academic_year: academicYear,
                        department: departmentFocus === 'all' ? 'General' : departmentFocus,
                        college: 'College of Science',
                        status: 'pending'
                    });

                    classIndex++;
                }
            }

            updateClassesPreview();
            document.getElementById('downloadClasses').disabled = false;
            checkAllGenerated();
        }

        function updateClassesPreview() {
            const preview = document.getElementById('classesPreview');
            const tableBody = document.getElementById('classesTableBody');
            const countBadge = document.getElementById('classCount');

            preview.style.display = 'block';
            countBadge.textContent = `${generatedData.classes.length} classes`;

            tableBody.innerHTML = generatedData.classes.slice(0, 50).map(c => `
                <tr>
                    <td><strong>${c.course_code}</strong></td>
                    <td>${c.course_name}</td>
                    <td><span class="badge badge-info">${c.section}</span></td>
                    <td>${c.schedule_day}</td>
                    <td>${c.schedule_time}</td>
                    <td>${c.credit_units}</td>
                </tr>
            `).join('');
        }

        // ==================== Teacher Schedules Generation ====================
        function generateTeacherSchedules() {
            const numTeachers = parseInt(document.getElementById('numTeachers').value);
            const classesPerTeacher = parseInt(document.getElementById('classesPerTeacher').value);
            const department = document.getElementById('teacherDepartment').value;

            generatedData.teachers = [];

            const departments = department === 'all' 
                ? ['Computer Science', 'Engineering', 'Business Administration', 'Arts & Sciences', 'Education']
                : [department];

            for (let i = 0; i < numTeachers; i++) {
                const firstName = randomElement(firstNames);
                const lastName = randomElement(lastNames);
                const teacherDept = randomElement(departments);
                const numClasses = random(Math.max(1, classesPerTeacher - 2), classesPerTeacher + 2);

                for (let c = 0; c < numClasses; c++) {
                    generatedData.teachers.push({
                        teacher_id: generateTeacherId(i + 1),
                        teacher_name: `Prof. ${firstName} ${lastName}`,
                        schedule_day: randomElement(days),
                        schedule_time: randomElement(timeSlots),
                        department: teacherDept,
                        email: generateEmail(firstName, lastName),
                        college: 'College of Science'
                    });
                }
            }

            updateTeachersPreview();
            document.getElementById('downloadTeachers').disabled = false;
            checkAllGenerated();
        }

        function updateTeachersPreview() {
            const preview = document.getElementById('teachersPreview');
            const tableBody = document.getElementById('teachersTableBody');
            const countBadge = document.getElementById('teacherCount');

            preview.style.display = 'block';
            const uniqueTeachers = [...new Set(generatedData.teachers.map(t => t.teacher_id))].length;
            countBadge.textContent = `${uniqueTeachers} teachers, ${generatedData.teachers.length} schedules`;

            // Show unique teachers
            const uniqueTeacherData = [];
            const seen = new Set();
            for (const t of generatedData.teachers) {
                if (!seen.has(t.teacher_id)) {
                    seen.add(t.teacher_id);
                    uniqueTeacherData.push(t);
                }
            }

            tableBody.innerHTML = uniqueTeacherData.slice(0, 50).map(t => `
                <tr>
                    <td>${t.teacher_id}</td>
                    <td>${t.teacher_name}</td>
                    <td>${t.email}</td>
                    <td><span class="badge badge-info">${t.department}</span></td>
                    <td>${t.schedule_day}</td>
                    <td>${t.schedule_time}</td>
                </tr>
            `).join('');
        }

        // ==================== CSV Download Functions ====================
        function convertToCSV(data, type) {
            if (data.length === 0) return '';

            // Define headers based on type - MATCHING DATABASE COLUMNS
            // Note: school_name for rooms is entered separately in the UploadCSV page
            const headers = {
                rooms: ['campus', 'building', 'room', 'capacity', 'is_first_floor', 'floor_number', 'room_type', 'has_ac', 'has_projector', 'has_whiteboard', 'is_pwd_accessible', 'status'],
                classes: ['course_code', 'course_name', 'section', 'lec_units', 'lab_units', 'credit_units', 'lec_hours', 'lab_hours', 'schedule_day', 'schedule_time', 'semester', 'academic_year', 'department', 'college', 'status'],
                teachers: ['teacher_id', 'teacher_name', 'schedule_day', 'schedule_time', 'department', 'email', 'college']
            };

            const cols = headers[type];
            // Use comma separator for proper CSV format (Excel compatible)
            const csvRows = [cols.join(',')];

            for (const row of data) {
                const values = cols.map(col => {
                    let val = row[col];
                    if (val === undefined || val === null) val = '';
                    if (typeof val === 'boolean') val = val ? 'true' : 'false';
                    // Escape values that contain commas or quotes
                    let strVal = String(val);
                    if (strVal.includes(',') || strVal.includes('"') || strVal.includes('\n')) {
                        strVal = '"' + strVal.replace(/"/g, '""') + '"';
                    }
                    return strVal;
                });
                csvRows.push(values.join(','));
            }

            return csvRows.join('\n');
        }

        function downloadCSV(type) {
            const data = generatedData[type];
            if (!data || data.length === 0) {
                alert(`No ${type} data generated yet!`);
                return;
            }

            const csv = convertToCSV(data, type);
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            const filename = {
                rooms: 'test_campuses_rooms.csv',
                classes: 'test_class_schedules.csv',
                teachers: 'test_teacher_schedules.csv'
            };

            link.setAttribute('href', url);
            link.setAttribute('download', filename[type]);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        async function downloadAllCSV() {
            const types = ['rooms', 'classes', 'teachers'];
            const hasAll = types.every(type => generatedData[type] && generatedData[type].length > 0);
            
            if (!hasAll) {
                alert('Please generate all data types before downloading all!');
                return;
            }

            for (const type of types) {
                downloadCSV(type);
                await new Promise(resolve => setTimeout(resolve, 500));
            }
        }

        function checkAllGenerated() {
            const types = ['rooms', 'classes', 'teachers'];
            const hasAll = types.every(type => generatedData[type] && generatedData[type].length > 0);
            document.getElementById('downloadAll').disabled = !hasAll;
        }

        // ==================== Quick Generate All ====================
        function generateAll() {
            generateRooms();
            generateClassSchedules();
            generateTeacherSchedules();
        }
    </script>
</body>
</html>
